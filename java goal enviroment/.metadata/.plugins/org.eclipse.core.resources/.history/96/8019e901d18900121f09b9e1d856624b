import java.awt.Point;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.LinkedList;
import java.util.Map;
import java.util.Random;

import eis.EIDefaultImpl;
import eis.exceptions.ActException;
import eis.exceptions.EntityException;
import eis.exceptions.ManagementException;
import eis.exceptions.NoEnvironmentException;
import eis.exceptions.PerceiveException;
import eis.iilang.Action;
import eis.iilang.EnvironmentState;
import eis.iilang.Parameter;
import eis.iilang.Percept;

public class Environment extends EIDefaultImpl {

	private static final long serialVersionUID = 1L;
	private ObjectOnTile[][] grid = new ObjectOnTile[3][3]; 
	private Point packageGoal;
	private Point manPos;
	
	public Environment()
	{
		System.out.println("constructor");
		manPos = random(-1,-1);
		Point pack = random(manPos.x,manPos.y);
		grid[pack.y][pack.x] = ObjectOnTile.Package;
		packageGoal = random(pack.x,pack.y);
	}
	
	private Point random(int x, int y)
	{
		Random rnd = new Random();
		Point p = new Point();
		while((p.x = rnd.nextInt() % 3) != x && (p.y = rnd.nextInt() % 3) != y)
		{
			
		}
		
		return p;
	}
	
	@Override
	public void init(Map<String, Parameter> parameters)
			throws ManagementException {
		System.out.println("init");
		super.init(parameters);
		try {
			this.addEntity("agent");
		} catch (EntityException e) {
			e.printStackTrace();
		}

		setState(EnvironmentState.PAUSED);
	}

	@Override
	public void start() throws ManagementException {
		setState(EnvironmentState.RUNNING);
	}
	
	public static void main(String[] args) {
		System.out.println("main");
		new Environment();
	}
	
	@Override
	public String requiredVersion() {
		return "0.3";
	}

	@Override
	protected LinkedList<Percept> getAllPerceptsFromEntity(String arg0)
			throws PerceiveException, NoEnvironmentException {
		
		LinkedList<Percept> percepts = new LinkedList<Percept>();
		
		percepts.add(new Percept(""));
		
		return percepts;
	}

	@Override
	protected boolean isSupportedByEntity(Action arg0, String arg1) {
		// TODO Auto-generated method stub
		return true;
	}

	@Override
	protected boolean isSupportedByEnvironment(Action arg0) {
		// TODO Auto-generated method stub
		return true;
	}

	@Override
	protected boolean isSupportedByType(Action arg0, String arg1) {
		// TODO Auto-generated method stub
		return true;
	}

	@Override
	protected Percept performEntityAction(String arg0, Action action)
			throws ActException {
		
		return null;
	}

}
